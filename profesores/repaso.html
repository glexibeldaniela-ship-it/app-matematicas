<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión de Repasos</title>

<style>

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#1e3a8a,#2563eb);
  color:white;
}

.header{
  padding:20px;
  text-align:center;
  background:rgba(0,0,0,0.2);
}

.panel{
  padding:20px;
}

input, select, textarea{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border:none;
  border-radius:10px;
  font-size:14px;
}

textarea{
  height:120px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  margin-bottom:10px;
}

.guardar{ background:#22c55e; color:white; }
.volver{ background:#111827; color:white; }

.repaso-card{
  background:rgba(255,255,255,0.1);
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
}

</style>
</head>

<body>

<div class="header">
  <h1>Mateedupro2026</h1>
  <p>Módulo de Repasos</p>
</div>

<div class="panel">

  <h3>Crear Nuevo Repaso</h3>

  <input type="text" id="titulo" placeholder="Título del repaso" required>

  <select id="anio">
    <option value="">Seleccione Año</option>
    <option>1</option>
    <option>2</option>
    <option>3</option>
    <option>4</option>
    <option>5</option>
  </select>

  <input type="text" id="seccion" placeholder="Sección (Ej: A, B)">

  <input type="text" id="lapso" placeholder="Lapso (1,2,3)">

  <textarea id="contenido" placeholder="Escribe aquí el contenido del repaso..."></textarea>

  <button class="guardar" onclick="guardarRepaso()">Guardar Repaso</button>

  <hr>

  <h3>Repasos Creados</h3>
  <div id="listaRepasos"></div>

  <button class="volver" onclick="location.href='../panel-profesor.html'">
    Volver al Panel
  </button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqSVoNR5y3kXb-Aihf1UwmvTwo1T0xm_8",
  authDomain: "mateedupro2026-897fa.firebaseapp.com",
  projectId: "mateedupro2026-897fa",
  storageBucket: "mateedupro2026-897fa.firebasestorage.app",
  messagingSenderId: "242144964491",
  appId: "1:242144964491:web:04eb900f523a91ef66498e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.guardarRepaso = async function(){

  const titulo = document.getElementById("titulo").value;
  const anio = document.getElementById("anio").value;
  const seccion = document.getElementById("seccion").value;
  const lapso = document.getElementById("lapso").value;
  const contenido = document.getElementById("contenido").value;

  if(!titulo || !anio || !contenido){
    alert("Completa los campos obligatorios");
    return;
  }

  await addDoc(collection(db, "repasos"), {
    titulo,
    anio,
    seccion,
    lapso,
    contenido,
    activo: true,
    creado: new Date()
  });

  alert("Repaso guardado correctamente");

  document.getElementById("titulo").value="";
  document.getElementById("anio").value="";
  document.getElementById("seccion").value="";
  document.getElementById("lapso").value="";
  document.getElementById("contenido").value="";

  cargarRepasos();
}

async function cargarRepasos(){

  const lista = document.getElementById("listaRepasos");
  lista.innerHTML="";

  const querySnapshot = await getDocs(collection(db,"repasos"));

  querySnapshot.forEach((documento)=>{

    const data = documento.data();

    lista.innerHTML += `
      <div class="repaso-card">
        <strong>${data.titulo}</strong><br>
        Año: ${data.anio} - Sección: ${data.seccion}<br>
        Lapso: ${data.lapso}<br><br>
        <button onclick="eliminarRepaso('${documento.id}')">
          Eliminar
        </button>
      </div>
    `;

  });

}

window.eliminarRepaso = async function(id){
  if(confirm("¿Eliminar este repaso?")){
    await deleteDoc(doc(db,"repasos",id));
    cargarRepasos();
  }
}

cargarRepasos();

</script>

</body>
</html>
