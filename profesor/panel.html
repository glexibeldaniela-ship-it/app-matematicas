<script type="module">

console.log("ðŸ”¥ SCRIPT PANEL CARGADO");

import { auth } from "../js/firebase.js";
import { db } from "../js/firebase.js";

import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const lista = document.getElementById("listaGuias");

/* ðŸ” Esperar autenticaciÃ³n */
onAuthStateChanged(auth, (user) => {

  if (!user) {
    alert("No has iniciado sesiÃ³n");
    window.location.href = "../index.html";
    return;
  }

  console.log("Usuario activo:", user.email);

  /* ðŸš€ Activar botÃ³n SOLO cuando el usuario ya estÃ¡ listo */
  const boton = document.getElementById("publicar");

  boton.addEventListener("click", async () => {

    console.log("BotÃ³n presionado");

    const titulo = document.getElementById("titulo").value.trim();
    const descripcion = document.getElementById("descripcion").value.trim();
    const driveURL = document.getElementById("driveURL").value.trim();

    if (!titulo || !descripcion || !driveURL) {
      alert("Completa todos los campos");
      return;
    }

    try {

      await addDoc(collection(db, "guias"), {
        titulo,
        descripcion,
        driveURL,
        profesor: user.email,
        fecha: Date.now()
      });

      alert("GuÃ­a publicada correctamente âœ…");

      document.getElementById("titulo").value = "";
      document.getElementById("descripcion").value = "";
      document.getElementById("driveURL").value = "";

      cargarGuias();

    } catch (error) {
      console.error("ðŸ”¥ ERROR REAL:", error);
      alert("Error: " + error.message);
    }

  });

  cargarGuias();

});


/* ðŸ“š Cargar guÃ­as */
async function cargar